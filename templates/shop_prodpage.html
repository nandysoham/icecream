{% extends 'shop_basic.html' %}
{% block title %}
{{ product.pname}} - Soham Icecreams
{% endblock title %}

{% block body%}
<div class="container my-4">
<div class="row">
<div class="col-md-4">
<div class="row">
<img src="/static/photos/icecream.jpg" width="300px" height="400px">
</div>
<div class="row">
<button type="button" class="btn btn-secondary mx-2 my-2">Add To Card</button>
<button type="button" class="btn btn-secondary my-2">Buy Now</button>
</div>
</div>
<div class ="col-md-8">
<h2><strong>{{ product.pname}}</strong></h2>
<h5>Rs {{ product.pprice}} </h5>
<p>{{product.pdesc}}</p>
<p>{{product.pfulldesc}}</p>

</div>
</div>




{% endblock body%}

{% block JavaScript %}
<script>
{% comment %} console.log('working');
  if (localStorage.getItem('cart')==null) {
    var cart={};
  }
  else
  {
    cart=JSON.parse(localStorage.getItem('cart'));
    document.getElementById('cart').innerHTML= Object.keys(cart).length;
    //to get the exact length of cart at the time of refreshing
  }
  $('.cart').click(function(){
    //console.log('clicked');
    idstr=this.id.toString();
    //console.log(idstr);
    if (cart[idstr]!=undefined){
      cart[idstr]=cart[idstr]+1;
    }
    else{
      cart[idstr]=1;
    }
    console.log(cart);
    localStorage.setItem('cart', JSON.stringify(cart));
    //note this is used to update the cart everytime you refresh
    document.getElementById('cart').innerHTML= Object.keys(cart).length ;
    });
    $('#popcart').popover();
    document.getElementById('popcart').setAttribute('data-content','<h5>cart</h5>') {% endcomment %}


if (localStorage.getItem('cart')==null) {
    var cart={};
  }
  else
  {
    cart=JSON.parse(localStorage.getItem('cart'));
    document.getElementById('cart').innerHTML= Object.keys(cart).length;
    //to get the exact length of cart at the time of refreshing
  }


  function updatepopover(cart)
    {
      //console.log('we are inside popover');
      var popstr = "";
      popstr =popstr + "<h5>Your Shopping Cart</h5> <div class='mx-2 my-2'>";
      var i = 1;
      var price = 0;
      for (var item in cart){
        if (parseInt(cart[item][0])>0){ 
        popstr = popstr + "<b>" + i+". " + "</b>";
        price1=cart[item][2];
        i_price=parseInt(price1);
        qty = parseInt(cart[item][0]);
        price = price + (i_price * qty) ;
        proddesc=cart[item][1];
        
        
        popstr = popstr + proddesc.slice(0,15) + "... Qty: " + cart[item][0]  + " Rs  " + i_price + '<br>';
        i=i+1;
       
        }
      }
      
      //console.log(price);
      popstr = popstr +  "TOTAL Rs " + price  ;
      //popstr = popstr + "<a href ='/login'> <button class='btn btn-primary' id='checkout'> Checkout</button> <button class='btn btn-primary' id='clearcart' onclick = 'clearcart()'> Clear Cart</button>";
      popstr = popstr + "</div> <a href='/checkout'><button class='btn btn-primary' id ='checkout'>Checkout</button></a> <button class='btn btn-primary' onclick='clearcart()' id ='clearcart'>Clear Cart</button>     "

      //console.log(popstr);
      document.getElementById('popcart').setAttribute('data-content',popstr);
    }
updatepopover(cart);
$('#popcart').popover('show');


    
</script>
 {% endblock JavaScript%}